{% load static %}
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <title>모델 선택</title>
  <link rel="stylesheet" href="{% static 'css/base.css' %}">
  <style>
    /* 레이아웃 */
    .select-wrap {}
    .select-inner {width: min(1000px, 92vw);display: grid;gap: 28px;justify-items: center;}
    .headline {font-family: "Jua", system-ui, -apple-system, Arial, sans-serif; font-size: clamp(22px, 3.6vw, 34px); color: #333; letter-spacing: .3px; text-align: center; }
    .subline {color: #333; font-size: 14px; text-align: center; margin-top: -6px;}

    /* === 원형 배치 컨테이너(방사형) === */
    .radial {position: relative; width: min(560px, 86vw); height: min(560px, 86vw); margin: 6px auto 0;}
    .radial svg {position: absolute; inset: 0; width: 100%; height: 100%; pointer-events: none; /* 클릭 방지 */}
    .center-dot {position: absolute;left: 50%; top: 50%;width: 12px; height: 12px; transform: translate(-50%,-50%); background: #1e3a8a; border-radius: 50%; box-shadow: 0 0 0 6px rgba(30,58,138,.08);}

    /* 원형 버튼 */
    .model-circle {position: absolute; width: 160px; height: 160px; border-radius: 999px; background: #fff; border: 2px solid #e6eaf5; box-shadow: 0 2px 11px rgba(0, 0, 0, 0.205);display: flex; align-items: center; justify-content: center;flex-direction: column;text-align: center;padding: 16px;cursor: pointer;transition: transform .18s ease, box-shadow .18s ease, border-color .18s ease;user-select: none;font-family: "Jua", system-ui, -apple-system, Arial, sans-serif;color: #1e3a8a;font-size: 16px;line-height: 1.25;background-image: radial-gradient(ellipse at top, rgba(30,58,138,.05), transparent 50%); font-weight: bold;}
    .model-circle span{font-weight: normal;font-size: 14px;margin-top: 3px;}
    .model-circle:hover,
    .model-circle:focus-visible {transform: translateY(-6px) scale(1.04);box-shadow: 0 14px 28px rgba(32, 34, 39, 0.16);border-color: #cfd8f3;outline: none;}
    .model-circle:active {transform: translateY(0) scale(1.0);box-shadow: 0 6px 14px rgba(30,58,138,.14);}

    /* 모바일 대응 */
    @media (max-width: 640px) {
      .model-circle { width: 130px; height: 130px; font-size: 16px; }
    }
  </style>
</head>
<body>
    {% include "header.html" %}
    <div class="select-wrap">
        <div class="select-inner">
            <h1 class="headline">머신러닝 모델을 선택하세요</h1>
            <p class="subline">원을 클릭하면 해당 모델로 이동합니다.</p>

            <form id="modelForm" method="get" action="{% url 'bike:ml_home' %}">
            {% csrf_token %}
            <input type="hidden" name="model" id="modelInput" value="{{ form.model.value|default_if_none:'' }}"/>

            <!-- 방사형 배치 컨테이너 -->
            <div class="radial" id="radial">
                <!-- 중심점 -->
                <div class="center-dot" aria-hidden="true"></div>
                <!-- 선(중심 ↔︎ 원) 그릴 SVG -->
                <svg id="radialLines" viewBox="0 0 100 100" preserveAspectRatio="none"></svg>

                {# 각 모델을 원형 버튼으로 렌더 (위치는 JS에서 배치) #}
                {% for value, label in form.model.field.choices %}
                <button type="button"
                        class="model-circle"
                        data-model="{{ value }}"
                        title="{{ label|striptags}}">
                    {{ label|safe }}
                </button>
                {% endfor %}
            </div>
            </form>
        </div>
    </div>

    <script>
        // 원 클릭 시 폼 제출
        document.querySelectorAll(".model-circle").forEach(function(btn) {
            btn.addEventListener("click", function() {
            const modelValue = this.getAttribute("data-model");
            document.getElementById("modelInput").value = modelValue;
            document.getElementById("modelForm").submit();
            });
        });

        // ===== 방사형 배치 + 선 연결 =====
        function layoutRadial() {
            const wrap = document.getElementById("radial");
            const svg  = document.getElementById("radialLines");
            const nodes = Array.from(wrap.querySelectorAll(".model-circle"));

            if (!wrap || nodes.length === 0) return;

            const W = wrap.clientWidth;
            const H = wrap.clientHeight;
            const cx = W / 2;
            const cy = H / 2;

            // 버튼 반지름(절반) – 실제 원 크기에서 계산
            const rBtn = nodes[0].offsetWidth / 2;
            // 반지름(중심에서 버튼 중심까지 거리). 적당히 여백을 빼서 설정
            const R = Math.min(W, H) / 2 - rBtn - 8;

            // 각도 배치: 3개면 보기 좋은 -90°, 30°, 150° (시계 반대)
            const N = nodes.length;
            const startDeg = (N === 3) ? -90 : -90; // 시작 각도는 위쪽부터
            const step = 360 / N;

            // SVG 좌표계를 100x100 기준으로 사용 → 픽셀을 백분율로 변환
            function pxToSvg(x, y) {
            return { x: (x / W) * 100, y: (y / H) * 100 };
            }

            // 선 초기화
            svg.innerHTML = "";

            nodes.forEach((node, i) => {
            const deg = startDeg + step * i;
            const rad = deg * Math.PI / 180;
            const x = cx + R * Math.cos(rad);
            const y = cy + R * Math.sin(rad);

            // 버튼 위치 (좌상단 기준으로 배치)
            node.style.left = (x - rBtn) + "px";
            node.style.top  = (y - rBtn) + "px";

            // 중심 ↔︎ 버튼 중심을 연결하는 선 추가
            const p1 = pxToSvg(cx, cy);
            const p2 = pxToSvg(x, y);
            const line = document.createElementNS("http://www.w3.org/2000/svg", "line");
            line.setAttribute("x1", p1.x);
            line.setAttribute("y1", p1.y);
            line.setAttribute("x2", p2.x);
            line.setAttribute("y2", p2.y);
            line.setAttribute("stroke", "#cfd8f3");
            line.setAttribute("stroke-width", "0.8");
            line.setAttribute("vector-effect", "non-scaling-stroke"); // 확대 시 두께 유지
            svg.appendChild(line);
            });
        }

        // 최초/리사이즈 시 배치
        window.addEventListener("load", layoutRadial);
        window.addEventListener("resize", () => { clearTimeout(window.__radialT); window.__radialT = setTimeout(layoutRadial, 120); });
    </script>
</body>
</html>


